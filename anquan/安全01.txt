





Linux基本防护措施

修改用户zhangsan的账户属性，设置为2019-12-31日失效（禁止登录）

1.正常情况下，未过期的账号可以正常登录，使用chage可以修改账户有效期。
chage命令的语法格式：
chage –l    账户名称                                //查看账户信息
chage –E 时间 账户名称                            //修改账户有效期

失效的用户将无法登录

 定义默认有效期（扩展知识）
/etc/login.defs这个配置文件，决定了账户密码的默认有效期。
[root@svr5 ~]# cat /etc/login.defs
PASS_MAX_DAYS    99999                        //密码最长有效期
PASS_MIN_DAYS    0                            //密码最短有效期
PASS_MIN_LEN    5                            //密码最短长度
PASS_WARN_AGE    7                            //密码过期前几天提示警告信息
UID_MIN                  1000                //UID最小值
UID_MAX                 60000                //UID最大值

 锁定用户账号
 使用passwd或usermod命令将用户lisi的账户锁定。
[root@svr5 ~]# passwd -l lisi                           //锁定用户账号lock
 锁定用户 lisi 的密码。
passwd: 操作成功
[root@svr5 ~]# passwd -S lisi                          //查看状态status
lisi LK 2018-02-22 0 99999 7 -1 (密码已被锁定。)
验证用户lisi已无法登录，说明锁定生效
 输入正确的用户名、密码，始终提示“Login incorrect”，无法登录。


锁定文件/etc/resolv.conf、/etc/hosts

1）语法格式：
# chattr +i  文件名                    //锁定文件（无法修改、删除等）
# chattr -i  文件名                    //解锁文件
# chattr +a  文件名                    //锁定后文件仅可追加
# chattr -a  文件名                    //解锁文件
# lsattr 文件名                        //查看文件特殊属性
2) 使用+i锁定文件，使用lsattr查看属性
[root@svr5 ~]# chattr +i /etc/resolv.conf /etc/hosts
[root@svr5 ~]# lsattr /etc/resolv.conf /etc/hosts
----i--------e- /etc/resolv.conf
----i--------e- /etc/hosts
2）测试文件锁定效果
[root@svr5 ~]# rm -rf /etc/resolv.conf
rm: 无法删除"/etc/resolv.conf": 不允许的操作
[root@svr5 ~]# echo "192.168.4.1  gateway.tarena.com" >> /etc/hosts
bash: /etc/hosts: 权限不够
3）恢复这两个文件原有的属性（避免对后续实验造成影响）
[root@svr5 ~]# chattr -i /etc/resolv.conf /etc/hosts
[root@svr5 ~]# lsattr /etc/resolv.conf /etc/hosts
-------------e- /etc/resolv.conf
-------------e- /etc/hosts


使用sudo分配管理权限

使用su命令临时切换账户身份，并执行命令
允许softadm管理系统服务的权限
允许用户useradm通过sudo方式添加/删除/修改除root以外的用户账号
允许wheel组成员以特权执行/usr/bin/下的命令
为sudo机制启用日志记录，以便跟踪sudo执行操作

使用su命令临时切换账户身份，并以root执行命令

su(Substitute User)命令可以快速切换账户身份，普通用户切换账户身份时需要输入密码，root使用su命令切换任何身份都不需要密码，如法格式如下：
# su –  [账户名称]
# su -  [账户名称]  -c '命令'  
1)从普通用户切换为root账户身份(如果没有普通账户则需要先创建)
[jacob@svr5 ~]# whoami
jacob
[jacob@svr5 ~]# su –                    //切换账户，默认切换为root账户
密码:
[root@svr5 ~]# whoami                    //确认结果
root
2)以普通身份创建目录(如果没有普通账户则需要先创建)，以root身份重启服务
[root@svr5 ~]# su - tom  -c "mkdir /home/tom/test"        //管理员切换普通用户
[root@svr5 ~]# ll -d  /home/tom/test
[tom@svr5 ~]# su - -c "systemctl restart sshd"            //以管理员重启服务
密码：
● sshd.service - OpenSSH server daemon
Loaded: loaded (/usr/lib/systemd/system/sshd.service; enabled; vendor preset: enabled)
active: active (running) since 五 2018-01-19 08:59:40 CST; 1 months 4 days ago


允许softadm管理系统服务的权限

1）修改/etc/sudoers配置
修改/etc/sudoers可以直接使用vim编辑该文件，或使用visudo命令修改该文件。
为softadm授予相关脚本的执行权限，允许通过systemctl工具来管理系统服务。
如果没有softadm账户可以先创建该账户。
[root@svr5 ~]# vim /etc/sudoers            //修改文件后，需要使用wq强制保存
.. ..
softadm    ALL=(ALL)   /usr/bin/systemctl         
//授权softadm以root身份执行systemctl命令
2）切换为softadm用户，并验证sudo执行权限
[root@svr5 ~]# su – softadm
[softadm@svr5 ~]$ sudo -l
… …
[sudo] password for softadm:                            //输入softadm的口令
.. ..
用户 softadm 可以在该主机上运行以下命令：
    (ALL) /usr/bin/systemctl
[softadm@svr5 ~]$ systemctl start httpd                    //不用sudo时启动服务失败
Authentication is required
.. ..
[softadm@svr5 ~]$ sudo systemctl restart httpd          //通过sudo启动服务成功

允许用户useradm通过sudo方式添加/删除/修改除root以外的用户账号

1）修改/etc/sudoers配置
为useradm授予用户管理相关命令的执行权限，例外程序以!符号取反，放在后面。在执行相关程序时，可以利用通配符*。
[root@svr5 ~]# vim /etc/sudoers
.. ..
useradm ALL=(ALL)  /usr/bin/passwd,!/usr/bin/passwd root,/usr/sbin/user*,
 !/usr/sbin/user* * root
2）切换为useradm用户，验证sudo权限
可以通过sudo方式来添加/删除/修改普通用户：
[root@svr5 ~]# su – useradm
[useradm@svr5 ~]$ sudo -l
.. ..
用户useradm可以在该主机上运行以下命令：
    (root) /usr/bin/passwd, !/usr/bin/passwd root, /usr/sbin/user*,
!/usr/sbin/user* * root
[useradm@svr5 ~]$ sudo useradd newuser01                  //可以添加用户
[useradm@svr5 ~]$ sudo passwd newuser01                  //可以修改普通用户的口令
更改用户 newuser01 的密码 。
新的 密码：
重新输入新的 密码：
passwd： 所有的身份验证令牌已经成功更新。
但是不能修改root用户的密码：
[useradm@svr5 ~]$ sudo passwd root
对不起，用户 useradm 无权以 root 的身份在 localhost 上
执行 /usr/bin/passwd root。





















































